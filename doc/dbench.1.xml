<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE refentry PUBLIC "-//Samba-Team//DTD DocBook V4.2-Based Variant V1.0//EN" "http://www.samba.org/samba/DTD/samba-doc">
<refentry id="dbench.1">

<refmeta>
	<refentrytitle>dbench</refentrytitle>
	<manvolnum>1</manvolnum>
	<refmiscinfo class="source">dbench</refmiscinfo>
	<refmiscinfo class="manual">dbench: a multiprotocol loadtester.</refmiscinfo>
</refmeta>


<refnamediv>
	<refname>dbench</refname>
        <refpurpose>Utility to perform loadtesting for multiple protocols.</refpurpose>
</refnamediv>

<refsynopsisdiv>
	<cmdsynopsis>
		<command>dbench [ OPTIONS ] &lt;num-clients&gt;</command>
	</cmdsynopsis>
	
	<cmdsynopsis>
		<command>dbench</command>
		<arg choice="opt">-B --backend=&lt;backend&gt;</arg>
		<arg choice="opt">-t --timelimit=&lt;seconds&gt;</arg>
		<arg choice="opt">--warmup=&lt;seconds&gt;</arg>
		<arg choice="opt">-c --loadfile=&lt;filename&gt;</arg>
		<arg choice="opt">-R --targe-trate=&lt;throughput&gt;</arg>
		<arg choice="opt">--trunc-io=&lt;size&gt;</arg>
		<arg choice="opt">--run-once</arg>
		<arg choice="opt">--machine-readable</arg>

		<arg choice="opt">--iscsi=&lt;iSCSI url&gt;</arg>
		<arg choice="opt">--iscsi-initiatorname=&lt;iqn name&gt;</arg>

		<arg choice="opt">--nfs=&lt;nfs url&gt;</arg>

		<arg choice="opt">--smb-share=&lt;//SERVER/SHARE&gt;</arg>
		<arg choice="opt">--smb-user=&lt;user%password&gt;</arg>

		<arg choice="opt">--scsi=&lt;device&gt;</arg>
		<arg choice="opt">--allow-scsi-writes</arg>
	</cmdsynopsis>
	
</refsynopsisdiv>

  <refsect1><title>DESCRIPTION</title>
    <para>
      Dbench is a utility to loadtest network server. Dbench currently supports
      iSCSI, NFSv3, SCSI and SMB.
    </para>
  </refsect1>

  <refsect1><title>OPTIONS</title>
    <variablelist>
      <varlistentry><term>-B --backend=&lt;iscsi|nfs|scsi|smb&gt;</term>
        <listitem>
          <para>
	    This specifies which protocol to test with. Supported protocols
	    are iscsi, nfsv3, scsi and smbv1
	  </para>
        </listitem>
      </varlistentry>

      <varlistentry><term>-t --timelimit=&lt;seconds&gt;</term>
        <listitem>
          <para>
	    For how long to run the test. This argument is mutually exclusive
	    with --run-once.
	  </para>
        </listitem>
      </varlistentry>

      <varlistentry><term>--warmup=&lt;seconds&gt;</term>
        <listitem>
          <para>
	    Before starting to record throughput and latencies dbench will
	    first wait until all clients are running and then wait for the
	    target and its caches to warm up before it starts collecting
	    data.
	  </para>
          <para>
	    Setting warmup to 0 means not warmup and dbench will start running
	    the test immediately.
	  </para>
        </listitem>
      </varlistentry>


      <varlistentry><term>-c --loadfile=&lt;filename&gt;</term>
        <listitem>
          <para>
	    The loadfile is the script for the commands to run during the test.
	    This command is mandatory.
	  </para>
          <para>	    The loadfile is the script for the commands to run during the test.
	    This command is mandatory.
	    The content of this file depends on the backend protocol that is
	    beeing tested. See the protocol specific sections below for
	    the commands that apply to the backends.
	  </para>
        </listitem>
      </varlistentry>

      <varlistentry><term>-R --targetrate=&lt;throughput&gt;</term>
        <listitem>
          <para>
	    If the target rate is used dbench will try to keep each client
	    running at the indicated throughput rate by adjusting a 
	    delta that the dbench thread will sleep between commands.
	  </para>
          <para>
	    This is mainly useful for capacity testing of a known workload.
	    By using this argument it is possible to run each thread to match
	    the timings for the specific workload. By increasing the number of
	    threads until the target can no longer keep up it is possible
	    to measure how many clents/threads the target can service before
	    it becomes saturated and it can no longer keep up.
	  </para>
        </listitem>
      </varlistentry>

      <varlistentry><term>--trunc-io=&lt;integer&gt;</term>
        <listitem>
          <para>
	    Some targets may have limits on the size of I/O they can accept.
	    This argument will clamp all I/O read from the loadfile to not
	    exceed this value. This is mainly useful for using generic loadfiles
	    against targets that can not handle the I/O size.
	  </para>
        </listitem>
      </varlistentry>

      <varlistentry><term>--run-once</term>
        <listitem>
          <para>
	    Run the workload exactly once for each thread and exit the test
	    once all threads have finished. This option is mutualy exclusive
	    with --timelimit.
	  </para>
        </listitem>
      </varlistentry>

      <varlistentry><term>--machine-readable</term>
        <listitem>
          <para>
	    Output data during in a more machine friendly format.
	  </para>
        </listitem>
      </varlistentry>

      <varlistentry><term>--iscsi=&lt;iSCSI url&gt;</term>
        <listitem>
          <para>
	    iSCSI url for the target to connect to. The url format is :
	    iscsi://[&lt;username&gt;[%&lt;password&gt;]@]&lt;host&gt;[:&lt;port&gt;]/&lt;target-iqn&gt;/&lt;lun&gt;
	  </para>

	  <para>
	    Username and password are only required if the target requires CHAP
	    authentication. Optionally you can specify the username and
	    password using the environment variables LIBISCSI_CHAP_USERNAME and
	    LIBISCSI_CHAP_PASSWORD.
	  </para>

	  <para>
	    Host can be specified either as a hostname, an IPv4 address or an
	    IPv6 address.

	    Examples:
	    <screen format="linespecific">
	      iscsi://192.0.2.1/iqn.ronnie.test/1
	      iscsi://[2001:DB8::1]:3261/iqn.ronnie.test/1
	      iscsi://ronnie%password@iscsi.example.com/iqn.ronnie.test/1
	    </screen>
	  </para>
          <para>
	    This argument is only valid with iSCSI backend.
	  </para>
        </listitem>
      </varlistentry>

      <varlistentry><term>--iscsi-initiatorname=&lt;iqn name&gt;</term>
        <listitem>
          <para>
	    iSCSI initatorname to use when connecting to the target.
	  </para>
          <para>
	    This argument is only valid with iSCSI backend.
	  </para>
        </listitem>
      </varlistentry>

      <varlistentry><term>--nfs=&lt;NFS url&gt;</term>
        <listitem>
          <para>
	    NFS url for the target to connect to. The url format is :
	    nfs://&lt;server&gt;/&lt;path-of-export&gt;
	  </para>
          <para>
	    This argument is only valid with NFS backend.
	  </para>
        </listitem>
      </varlistentry>

      <varlistentry><term>--scsi=&lt;SCSI device&gt;</term>
        <listitem>
          <para>
	    Device name for the device to test.
	  </para>
          <para>
	    This argument is only valid with SCSI backend.
	  </para>
        </listitem>
      </varlistentry>

      <varlistentry><term>--allow-scsi-write</term>
        <listitem>
          <para>
	    Allow sending medium write commands to the device.
	  </para>
          <para>
	    This argument is only valid with SCSI backend.
	  </para>
        </listitem>
      </varlistentry>

      <varlistentry><term>--smb-share=&lt;//SERVER/SHARE&gt;</term>
        <listitem>
          <para>
	    Server and share to connect to for the SMB backend.
	  </para>
          <para>
	    This argument is only valid with SMB backend.
	  </para>
        </listitem>
      </varlistentry>

      <varlistentry><term>--smb-user=&lt;user%password&gt;</term>
        <listitem>
          <para>
	    Username and password to authenticate to the SMB server with.
	  </para>
          <para>
	    This argument is only valid with SMB backend.
	  </para>
        </listitem>
      </varlistentry>

    </variablelist>
  </refsect1>

  <refsect1><title>NFS commands</title>
    <variablelist>
      <varlistentry><term>&lt;timing&gt; ACCESS3 &lt;path&gt; 0 0 &lt;status&gt;</term>
        <listitem>
          <para>
	    Send a NFSv3 ACCESS3 command to the server.
	  </para>
          <para>
	    Example:
	    <screen format="linespecific">
	      0.000 ACCESS3 "/" 0 0 0x00000000
	    </screen>
          </para>
        </listitem>
      </varlistentry>

      <varlistentry><term>&lt;timing&gt; COMMIT3 &lt;path&gt; &lt;status&gt;</term>
        <listitem>
          <para>
	    Send a NFSv3 COMMIT3 command to the server.
	  </para>
          <para>
	    Example:
	    <screen format="linespecific">
	      0.000 COMMIT3 "/some-file" 0x00000000
	    </screen>
          </para>
        </listitem>
      </varlistentry>

      <varlistentry><term>&lt;timing&gt; CREATE3 &lt;path&gt; &lt;status&gt;</term>
        <listitem>
          <para>
	    Send a NFSv3 CREATE3 command to the server.
	  </para>
          <para>
	    Example:
	    <screen format="linespecific">
	      0.000 CREATE3 "/some-file" 0x00000000
	    </screen>
          </para>
        </listitem>
      </varlistentry>

      <varlistentry><term>&lt;timing&gt; FSINFO3 &lt;status&gt;</term>
        <listitem>
          <para>
	    Send a NFSv3 FSINFO3 command to the server.
	  </para>
          <para>
	    Example:
	    <screen format="linespecific">
	      0.000 FSINFO3 0x00000000
	    </screen>
          </para>
        </listitem>
      </varlistentry>

      <varlistentry><term>&lt;timing&gt; FSSTAT3 &lt;status&gt;</term>
        <listitem>
          <para>
	    Send a NFSv3 FSSTAT3 command to the server.
	  </para>
          <para>
	    Example:
	    <screen format="linespecific">
	      0.000 FSSTAT3 0x00000000
	    </screen>
          </para>
        </listitem>
      </varlistentry>

      <varlistentry><term>&lt;timing&gt; GETATTR3 &lt;path&gt; &lt;status&gt;</term>
        <listitem>
          <para>
	    Send a NFSv3 GETATTR3 command to the server.
	  </para>
          <para>
	    Example:
	    <screen format="linespecific">
	      0.000 GETATTR3 "/some-file" 0x00000000
	    </screen>
          </para>
        </listitem>
      </varlistentry>

      <varlistentry><term>&lt;timing&gt; LINK3 &lt;path&gt; &lt;path&gt; &lt;status&gt;</term>
        <listitem>
          <para>
	    Send a NFSv3 LINK3 command to the server.
	  </para>
          <para>
	    Example:
	    <screen format="linespecific">
	      0.000 LINK3 "/hard-link" "/original-file" 0x00000000
	    </screen>
          </para>
        </listitem>
      </varlistentry>

      <varlistentry><term>&lt;timing&gt; LOOKUP3 &lt;path&gt; &lt;status&gt;</term>
        <listitem>
          <para>
	    Send a NFSv3 LOOKUP3 command to the server.
	  </para>
          <para>
	    Example:
	    <screen format="linespecific">
	      0.000 LOOKUP3 "/some-file" 0x00000000
	    </screen>
          </para>
        </listitem>
      </varlistentry>

      <varlistentry><term>&lt;timing&gt; MKDIR3 &lt;path&gt; &lt;status&gt;</term>
        <listitem>
          <para>
	    Send a NFSv3 MKDIR3 command to the server.
	  </para>
          <para>
	    Example:
	    <screen format="linespecific">
	      0.000 MKDIR3 "/some-file" 0x00000000
	    </screen>
          </para>
        </listitem>
      </varlistentry>

      <varlistentry><term>&lt;timing&gt; PATHCONF3 &lt;path&gt; &lt;status&gt;</term>
        <listitem>
          <para>
	    Send a NFSv3 PATHCONF3 command to the server.
	  </para>
          <para>
	    Example:
	    <screen format="linespecific">
	      0.000 PATHCONF3 "/some-file" 0x00000000
	    </screen>
          </para>
        </listitem>
      </varlistentry>

      <varlistentry><term>&lt;timing&gt; READDIRPLUS3 &lt;path&gt; &lt;status&gt;</term>
        <listitem>
          <para>
	    Send a NFSv3 READDIRPLUS3 command to the server.
	  </para>
          <para>
	    Example:
	    <screen format="linespecific">
	      0.000 READDIRPLUS3 "/some-directory" 0x00000000
	    </screen>
          </para>
        </listitem>
      </varlistentry>

      <varlistentry><term>&lt;timing&gt; READ3 &lt;path&gt; &lt;offset&gt; &lt;length&gt; &lt;status&gt;</term>
        <listitem>
          <para>
	    Send a NFSv3 READ3 command to the server.
	  </para>
          <para>
	    Example:
	    <screen format="linespecific">
	      0.000 READ3 "/some-file" 0 4096 0x00000000
	    </screen>
          </para>
        </listitem>
      </varlistentry>

      <varlistentry><term>&lt;timing&gt; READLINK3 &lt;path&gt; &lt;status&gt;</term>
        <listitem>
          <para>
	    Send a NFSv3 READLINK3 command to the server.
	  </para>
          <para>
	    Example:
	    <screen format="linespecific">
	      0.000 READLINK3 "/some-link" 0x00000000
	    </screen>
          </para>
        </listitem>
      </varlistentry>

      <varlistentry><term>&lt;timing&gt; REMOVE3 &lt;path&gt; &lt;status&gt;</term>
        <listitem>
          <para>
	    Send a NFSv3 REMOVE3 command to the server.
	  </para>
          <para>
	    Example:
	    <screen format="linespecific">
	      0.000 REMOVE3 "/some-directory" 0x00000000
	    </screen>
          </para>
        </listitem>
      </varlistentry>

      <varlistentry><term>&lt;timing&gt; RENAME3 &lt;old-path&gt; &lt;new-path&gt; &lt;status&gt;</term>
        <listitem>
          <para>
	    Send a NFSv3 RENAME3 command to the server.
	  </para>
          <para>
	    Example:
	    <screen format="linespecific">
	      0.000 RENAME3 "/old-name" "/new-name"  0x00000000
	    </screen>
          </para>
        </listitem>
      </varlistentry>

      <varlistentry><term>&lt;timing&gt; RMDIR3 &lt;path&gt; &lt;status&gt;</term>
        <listitem>
          <para>
	    Send a NFSv3 RMDIR3 command to the server.
	  </para>
          <para>
	    Example:
	    <screen format="linespecific">
	      0.000 RMDIR3 "/some-directory" 0x00000000
	    </screen>
          </para>
        </listitem>
      </varlistentry>

      <varlistentry><term>&lt;timing&gt; SYMLINK3 &lt;path&gt; &lt;path&gt; &lt;status&gt;</term>
        <listitem>
          <para>
	    Send a NFSv3 SYMLINK3 command to the server.
	  </para>
          <para>
	    Example:
	    <screen format="linespecific">
	      0.000 SYMLINK3 "/sym-link" "/original-file" 0x00000000
	    </screen>
          </para>
        </listitem>
      </varlistentry>

      <varlistentry><term>&lt;timing&gt; WRITE3 &lt;path&gt; &lt;offset&gt; &lt;length&gt; &lt;stable&gt; &lt;status&gt;</term>
        <listitem>
          <para>
	    Send a NFSv3 WRITE3 command to the server.
	  </para>
          <para>
	    Example:
	    <screen format="linespecific">
	      0.000 WRITE3 "/some-file" 0 4096 2 0x00000000
	    </screen>
          </para>
        </listitem>
      </varlistentry>

    </variablelist>
  </refsect1>



  <refsect1><title>SEE ALSO</title>
    <para>
      dbench(1)
      <ulink url="http://github.com/sahlberg/dbench"/>
    </para>
  </refsect1>

</refentry>
